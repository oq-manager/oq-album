<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì˜¤í”¼ìŠ¤í€¸ ì•¨ë²” ê´€ë¦¬ì</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

  <style>
    [v-cloak] { display: none !important; }
    body { background-color: #eef2f6; font-family: 'Apple SD Gothic Neo', sans-serif; }
    .loader { border: 3px solid #f3f3f3; border-top: 3px solid #ec4899; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);} }
    .btn-press:active { transform: scale(0.95); }
    .hide-scroll::-webkit-scrollbar { display: none; }
    .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
    .gauge-fill { transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
    .btn-disabled { background-color: #d1d5db !important; color: #9ca3af !important; cursor: not-allowed; transform: none !important; }
  </style>
</head>

<body>
<div id="app" v-cloak class="max-w-md mx-auto bg-white min-h-screen shadow-xl relative flex flex-col overflow-hidden">

  <!-- ë¡œê·¸ì¸ -->
  <div v-if="!isLoggedIn" class="p-8 flex flex-col justify-center h-screen bg-pink-50 relative">
    <button @click="showHelpPopup = true" class="absolute top-4 right-4 text-gray-400 text-sm flex flex-col items-center">
      <i class="fas fa-question-circle text-xl mb-1"></i><span class="text-xs">ë„ì›€ë§</span>
    </button>
    <div class="text-center mb-10">
      <span class="text-4xl">ğŸ‘¸</span>
      <h1 class="text-3xl font-bold text-pink-600 mt-2">ì˜¤í”¼ìŠ¤í€¸<br>ì•¨ë²” êµí™˜ì†Œ</h1>
    </div>
    <div class="space-y-4">
      <input v-model="loginForm.server" type="number" placeholder="ì„œë²„ ë²ˆí˜¸ (ìˆ«ì)" class="w-full p-4 border rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-300">
      <input v-model="loginForm.nickname" type="text" placeholder="ë‹‰ë„¤ì„ (ê´€ë¦¬ìëŠ” 'ê´€ë¦¬ì')" class="w-full p-4 border rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-300">
      <input v-model="loginForm.password" type="password" maxlength="4" placeholder="ë¹„ë°€ë²ˆí˜¸ 4ìë¦¬" class="w-full p-4 border rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-300">
      <button @click="handleLogin"
              class="w-full bg-gradient-to-r from-pink-500 to-pink-400 text-white p-4 rounded-xl font-bold hover:from-pink-600 hover:to-pink-500 transition shadow-md flex justify-center items-center"
              :disabled="isLoading">
        <div v-if="isLoading" class="loader mr-2 border-white border-t-transparent"></div>
        <span>{{ isLoading ? 'ë¡œë”©ì¤‘...' : 'ì…ì¥í•˜ê¸°' }}</span>
      </button>
    </div>
    <p class="text-xs text-gray-400 text-center mt-6">ì„œë²„/ë‹‰ë„¤ì„ ì…ë ¥ ì‹œ ìë™ ê°€ì…ë©ë‹ˆë‹¤.</p>
  </div>

  <!-- ê´€ë¦¬ì ëª¨ë“œ -->
  <div v-else-if="isAdmin" class="flex flex-col h-screen bg-gray-900 text-white">

    <!-- âœ… ìƒë‹¨: ì¤„ë°”ê¿ˆ ë°©ì§€ + MASTER_ADMIN ì‚­ì œ -->
    <div class="p-4 border-b border-gray-700 flex justify-between items-center bg-gray-800">
      <h1 class="text-base font-bold text-yellow-400 whitespace-nowrap">ğŸ‘‘ VIP ê´€ë¦¬ìëª¨ë“œ</h1>
      <div class="flex gap-2 flex-none">
        <button @click="showAdminSettingsPopup = true" class="text-xs bg-gray-700 px-3 py-1 rounded hover:bg-gray-600">âš™ï¸ ì„¤ì •</button>
        <button @click="fetchAdminData" class="text-xs bg-gray-700 px-3 py-1 rounded hover:bg-gray-600">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        <button @click="logout" class="text-xs border border-gray-600 px-3 py-1 rounded hover:bg-gray-700">ë‚˜ê°€ê¸°</button>
      </div>
    </div>

    <div class="flex-1 overflow-y-auto hide-scroll p-4 space-y-6">

      <!-- íƒ­ -->
      <div class="flex gap-2">
        <button @click="adminTab='transfer'"
                class="flex-1 text-xs py-2 rounded font-bold"
                :class="adminTab==='transfer' ? 'bg-yellow-500 text-black' : 'bg-gray-800 text-gray-200 hover:bg-gray-700'">
          âš¡ ì¹´ë“œ ëª°ì•„ì£¼ê¸°
        </button>
        <button @click="adminTab='users'"
                class="flex-1 text-xs py-2 rounded font-bold"
                :class="adminTab==='users' ? 'bg-yellow-500 text-black' : 'bg-gray-800 text-gray-200 hover:bg-gray-700'">
          ğŸ§¹ ìœ ì € ê´€ë¦¬/ì‚­ì œ
        </button>
      </div>

      <!-- ì¹´ë“œ ëª°ì•„ì£¼ê¸° -->
      <div v-if="adminTab==='transfer'">
        <div class="mb-4">
          <label class="block text-xs text-gray-400 mb-2">ê´€ë¦¬í•  ìœ ì € ì„ íƒ (ë°›ëŠ” ì‚¬ëŒ)</label>
          <select v-model="adminTargetUserId" @change="calculateAdminMatches"
                  class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-yellow-500">
            <option value="" disabled>ì„ íƒí•´ì£¼ì„¸ìš”</option>
            <option v-for="user in adminUserListSorted" :key="user.id" :value="user.id">
              S{{ user.server }} {{ user.nickname }} ({{ user.totalCount }}/81)
            </option>
          </select>
          <p class="text-[10px] text-gray-500 mt-2">* ê´€ë¦¬ì í™”ë©´ì€ 0ì¥ ìœ ì €ë„ í¬í•¨í•´ì„œ ì „ì²´ ë¡œë“œë©ë‹ˆë‹¤.</p>
        </div>

        <div v-if="adminTargetUserId">
          <h3 class="text-sm font-bold text-gray-300 mb-3 border-l-4 border-yellow-500 pl-2">
            ë°œê²¬ëœ ì‰ì—¬ ìì› (ì¤„ ìˆ˜ ìˆëŠ” ì‚¬ëŒë“¤)
          </h3>

          <div v-if="adminMatchList.length === 0" class="text-center py-10 text-gray-500 bg-gray-800 rounded-lg border border-gray-700">
            <div class="text-2xl mb-2">ğŸ¤·â€â™‚ï¸</div>
            ì¤„ ìˆ˜ ìˆëŠ” ì¹´ë“œê°€ ì—†ê±°ë‚˜,<br>ì´ë¯¸ ë‹¤ ëª¨ìœ¼ì…¨ë„¤ìš”!
          </div>

          <div v-else class="space-y-3">
            <div v-for="(match, idx) in adminMatchList" :key="idx" class="bg-gray-800 border border-gray-700 rounded-lg p-4 shadow-lg">
              <div class="flex justify-between items-start mb-3">
                <div>
                  <span class="text-xs text-blue-400 font-bold block mb-1">ì£¼ëŠ” ì‚¬ëŒ (Donor)</span>
                  <span class="text-lg font-bold">S{{ match.user.server }} {{ match.user.nickname }}</span>
                  <div class="text-[10px] text-gray-400 mt-1">ë³´ìœ  {{ match.user.totalCount }}/81</div>
                </div>
                <button @click="executeAdminTransfer(match)"
                        class="bg-yellow-500 hover:bg-yellow-600 text-black font-bold px-4 py-2 rounded text-xs shadow-md transition flex items-center">
                  <i class="fas fa-bolt mr-1"></i> {{ match.giveable.length }}ì¥ ê°€ì ¸ì˜¤ê¸°
                </button>
              </div>

              <div class="bg-gray-900 rounded p-2 text-xs text-gray-400">
                <div class="flex flex-wrap gap-1">
                  <span v-for="(card, cIdx) in match.giveable" :key="cIdx"
                        class="bg-gray-700 text-gray-200 px-2 py-1 rounded border border-gray-600">
                    {{ card.name }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div v-else class="text-center py-16 text-gray-600">
          <i class="fas fa-user-cog text-4xl mb-4"></i><br>
          ìœ ì €ë¥¼ ì„ íƒí•˜ë©´<br><b>ì¹´ë“œ ëª°ì•„ì£¼ê¸°</b>ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
        </div>
      </div>

      <!-- ìœ ì € ê´€ë¦¬/ì‚­ì œ -->
      <div v-else>
        <div class="bg-gray-800 border border-gray-700 rounded-xl p-4">
          <div class="flex items-center justify-between mb-3">
            <h3 class="font-bold text-gray-200 text-sm">ğŸ§¹ ìœ ì € ê´€ë¦¬</h3>
            <span class="text-[10px] text-gray-400">ì´ {{ adminUsersForManage.length }}ëª…</span>
          </div>

          <div class="flex items-center gap-2 mb-3">
            <input v-model="adminUserSearch" type="text" placeholder="ì„œë²„/ë‹‰ë„¤ì„ ê²€ìƒ‰"
                   class="flex-1 p-2 bg-gray-900 border border-gray-700 rounded text-xs text-white focus:outline-none focus:border-yellow-500"/>
            <button @click="toggleAdminOnlyZero"
                    class="text-[10px] px-2 py-2 rounded font-bold"
                    :class="adminOnlyZero ? 'bg-yellow-500 text-black' : 'bg-gray-700 text-gray-200 hover:bg-gray-600'">
              0ì¥ë§Œ ë³´ê¸°
            </button>
          </div>

          <div class="grid grid-cols-2 gap-2">
            <button @click="resetEventAllUsers"
                    class="text-xs bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 rounded">
              ğŸ§¨ ì´ë²¤íŠ¸ ì´ˆê¸°í™”
            </button>
            <button @click="deleteAllZeroUsers"
                    class="text-xs bg-red-600 hover:bg-red-700 text-white font-bold py-2 rounded">
              ğŸ§¹ 0ì¥ ìœ ì € ì¼ê´„ ì‚­ì œ
            </button>
          </div>

          <div class="mt-2">
            <button @click="fetchAdminData"
                    class="w-full text-xs bg-gray-700 hover:bg-gray-600 py-2 rounded font-bold">
              ğŸ”„ ìƒˆë¡œê³ ì¹¨
            </button>
          </div>

          <p class="text-[10px] text-gray-400 mt-2 leading-relaxed">
            * <b>ì´ë²¤íŠ¸ ì´ˆê¸°í™”</b>ëŠ” ëª¨ë“  ìœ ì €ì˜ ì¹´ë“œê°’ì„ 0ìœ¼ë¡œ ë˜ëŒë¦½ë‹ˆë‹¤(ê³„ì •ì€ ìœ ì§€).<br>
            * ì‚­ì œëŠ” ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>
            * ê´€ë¦¬ì ê³„ì •ì€ ì œì™¸ë©ë‹ˆë‹¤.
          </p>
        </div>

        <div class="mt-4">
          <div v-if="isLoading" class="flex justify-center py-10"><div class="loader"></div></div>

          <div v-else class="space-y-2">
            <div v-for="u in adminUsersForManage" :key="u.id"
                 class="bg-gray-800 border border-gray-700 rounded-xl p-3 flex items-center justify-between">
              <div class="flex flex-col">
                <div class="flex items-center gap-2">
                  <span class="text-[10px] bg-blue-500/20 text-blue-200 px-2 py-0.5 rounded font-bold">S{{ u.server }}</span>
                  <span class="font-bold text-gray-100 text-sm">{{ u.nickname }}</span>
                  <span v-if="u.totalCount===0" class="text-[10px] bg-red-500/20 text-red-200 px-2 py-0.5 rounded font-bold">0ì¥</span>
                </div>
                <div class="text-[10px] text-gray-400 mt-1">
                  ë³´ìœ  {{ u.totalCount }}/81 Â· ë§ˆì§€ë§‰ í™œë™ {{ getActiveText(u.lastActive) }}
                </div>
                <div class="text-[10px] text-gray-500 mt-0.5">docId: {{ u.id }}</div>
              </div>

              <button @click="deleteUser(u)"
                      class="text-xs bg-red-600 hover:bg-red-700 text-white font-bold px-3 py-2 rounded">
                ì‚­ì œ
              </button>
            </div>

            <div v-if="adminUsersForManage.length===0" class="text-center text-gray-500 text-xs py-10 bg-gray-800 rounded-xl border border-gray-700">
              í‘œì‹œí•  ìœ ì €ê°€ ì—†ì–´ìš”.
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- ì¼ë°˜ ìœ ì € ëª¨ë“œ -->
  <div v-else class="flex flex-col h-screen bg-[#f0f9ff]">
    <div class="sticky top-0 bg-white/90 backdrop-blur-sm z-20 border-b border-blue-100 p-3 shadow-sm flex-none">
      <div class="flex justify-between items-center mb-2">
        <div class="flex flex-col">
          <span class="font-bold text-gray-700 text-sm flex items-center">
            <span class="bg-blue-100 text-blue-600 px-2 py-0.5 rounded text-xs mr-1 font-bold">S{{ userData.server }}</span>
            {{ userData.nickname }}ë‹˜
          </span>
          <span class="text-[10px] font-bold mt-1" :class="tradeCount >= 3 ? 'text-red-500' : 'text-green-600'">
            <i class="fas fa-sync-alt mr-1"></i>
            ì˜¤ëŠ˜ êµí™˜ {{ tradeCount }}/3 {{ tradeCount >= 3 ? '(ë§ˆê°)' : '' }}
          </span>
        </div>
        <div class="flex gap-2 items-center">
          <button @click="showHelpPopup = true" class="text-gray-400 hover:text-blue-500"><i class="fas fa-question-circle text-lg"></i></button>
          <button @click="fetchUsersAndShowList" class="text-xs bg-blue-500 text-white px-2.5 py-1.5 rounded-lg font-bold shadow-sm hover:bg-blue-600 transition">ğŸ‘¥ ë©¤ë²„</button>
          <button @click="logout" class="text-xs text-gray-400 border border-gray-200 px-2 py-1 rounded hover:bg-gray-50">ë‚˜ê°€ê¸°</button>
        </div>
      </div>

      <div class="relative w-full h-7 bg-gray-200 rounded-full shadow-inner overflow-hidden border border-gray-300">
        <div class="absolute top-0 left-0 h-full bg-gradient-to-r from-pink-400 via-purple-400 to-indigo-400 gauge-fill" :style="{ width: totalProgress + '%' }"></div>
        <div class="absolute inset-0 flex items-center justify-center text-xs font-extrabold text-white drop-shadow-[0_1px_2px_rgba(0,0,0,0.6)] z-10">
          ì „ì²´ ìˆ˜ì§‘ë¥  {{ totalCount }}/81 ({{ totalProgress }}%)
        </div>
      </div>
    </div>

    <div class="flex-1 overflow-y-auto hide-scroll p-4 pb-20">
      <div v-if="currentView === 'dashboard'" class="grid grid-cols-3 gap-x-2 gap-y-6">
        <div v-for="(album, idx) in appConfig.albumNames" :key="idx" @click="openAlbum(idx)" class="flex flex-col items-center cursor-pointer group">
          <div class="w-20 h-20 rounded-full border-4 border-white shadow-lg overflow-hidden relative bg-white group-hover:scale-105 transition duration-200 ring-2 ring-gray-100">
            <img v-if="appConfig.albumCovers && appConfig.albumCovers[idx]" :src="appConfig.albumCovers[idx]" class="w-full h-full object-cover">
            <div v-else class="w-full h-full flex items-center justify-center bg-blue-50 text-3xl text-blue-200">ğŸ“</div>
            <div v-if="getAlbumCount(idx) === 9" class="absolute inset-0 bg-black/30 flex items-center justify-center"><i class="fas fa-check text-2xl text-green-400 drop-shadow-md"></i></div>
          </div>
          <div class="mt-2 mb-1 px-2 py-0.5 rounded bg-white/50 backdrop-blur-sm"><span class="text-[11px] font-bold text-gray-700 text-center block truncate max-w-[80px]">{{ album }}</span></div>
          <div class="w-20 h-4 bg-gray-600 rounded-full relative border border-white shadow-sm overflow-hidden">
            <div class="h-full bg-gradient-to-r from-yellow-400 to-yellow-500 rounded-full gauge-fill" :style="{ width: (getAlbumCount(idx) / 9) * 100 + '%' }"></div>
            <span class="absolute inset-0 flex items-center justify-center text-[9px] font-bold text-white drop-shadow-[0_1px_1px_rgba(0,0,0,0.5)]">{{ getAlbumCount(idx) }}/9</span>
          </div>
        </div>
      </div>

      <div v-if="currentView === 'detail'">
        <div class="flex justify-between items-center mb-4 bg-white p-2 rounded-xl shadow-sm border border-blue-100">
          <button @click="prevAlbum" class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 hover:bg-gray-200 btn-press text-gray-600"><i class="fas fa-chevron-left"></i></button>
          <h2 class="text-sm font-bold text-gray-800">{{ appConfig.albumNames[currentAlbumIdx] }}</h2>
          <button @click="nextAlbum" class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 hover:bg-gray-200 btn-press text-gray-600"><i class="fas fa-chevron-right"></i></button>
        </div>

        <div class="grid grid-cols-3 gap-1.5">
          <div v-for="(count, i) in currentAlbumCards" :key="i" class="bg-white rounded-lg p-1.5 shadow-sm border border-gray-100 flex flex-col h-28 relative">
            <div class="flex-1 bg-gray-50 rounded mb-1.5 relative overflow-hidden cursor-pointer border border-gray-200 group" @click="checkExchange(i)">
              <div class="absolute inset-0 flex flex-col items-center justify-center text-gray-300">
                <span class="text-[9px]">ì‚¬ì§„</span><span class="text-xs font-bold">{{ i + 1 }}</span>
              </div>
              <div v-if="count === 0" class="absolute inset-0 bg-white/90 flex flex-col items-center justify-center text-red-500 font-bold z-10 group-hover:bg-white/70 transition">
                <i class="fas fa-search text-lg mb-1"></i><span class="text-[9px]">êµ¬í•´ìš”</span>
              </div>
            </div>
            <div class="flex items-center justify-between bg-gray-50 rounded-full p-0.5 border border-gray-200">
              <button @click="updateCount(i, -1)" class="w-5 h-5 rounded-full bg-white shadow-sm text-gray-500 flex items-center justify-center text-xs border border-gray-200 btn-press font-bold">-</button>
              <span class="flex-1 text-center text-xs font-bold" :class="count > 0 ? 'text-blue-600' : 'text-gray-300'">{{ count }}</span>
              <button @click="updateCount(i, 1)" class="w-5 h-5 rounded-full bg-blue-500 shadow-sm text-white flex items-center justify-center text-xs btn-press font-bold border-none">+</button>
            </div>
          </div>
        </div>

        <div class="mt-6 flex justify-center">
          <button @click="currentView = 'dashboard'" class="px-6 py-2 bg-gray-800 text-white text-xs rounded-full font-bold shadow-lg hover:bg-gray-700 transition flex items-center">
            <i class="fas fa-th-large mr-2"></i> ì•¨ë²” ëª©ë¡ìœ¼ë¡œ
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ íŒì—… -->
  <div v-if="showUserListPopup" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4" @click.self="showUserListPopup = false">
    <div class="bg-white rounded-2xl w-full max-w-sm p-5 relative max-h-[80vh] overflow-y-auto shadow-2xl">
      <button @click="showUserListPopup = false" class="absolute top-4 right-4 text-gray-300 hover:text-gray-500"><i class="fas fa-times"></i></button>
      <h3 class="text-base font-bold mb-4 text-gray-800">ğŸ‘¥ í™œë™ ë©¤ë²„ <span class="text-blue-500">{{ filteredUserList.length }}ëª…</span></h3>

      <div class="mb-3 relative">
        <input v-model="searchKeyword" type="text" placeholder="ë‹‰ë„¤ì„ ê²€ìƒ‰" class="w-full p-2.5 pl-9 border border-gray-200 rounded-xl text-sm bg-gray-50 focus:bg-white focus:ring-2 focus:ring-blue-100 transition">
        <i class="fas fa-search absolute left-3 top-3 text-gray-400 text-xs"></i>
      </div>

      <div v-if="isLoading" class="flex justify-center py-8"><div class="loader"></div></div>
      <div v-else class="space-y-2">
        <div v-for="user in filteredUserList" :key="user.id" @click="openCompare(user)" class="border border-gray-100 p-3 rounded-xl flex justify-between items-center hover:bg-blue-50 hover:border-blue-100 cursor-pointer transition group">
          <div class="flex items-center">
            <div class="w-2 h-2 rounded-full mr-2" :class="getActiveColor(user.lastActive)"></div>
            <span class="bg-blue-100 text-blue-600 text-[10px] px-1.5 py-0.5 rounded font-bold mr-2">S{{ user.server }}</span>
            <div class="flex flex-col">
              <span class="font-bold text-gray-700 text-sm group-hover:text-blue-600 flex items-center">
                {{ user.nickname }}
                <i v-if="user.totalCount >= 81" class="fas fa-trophy text-yellow-500 ml-1 text-xs"></i>
              </span>
              <div class="flex items-center gap-2">
                <span class="text-[9px] text-gray-400">{{ getActiveText(user.lastActive) }}</span>
                <span class="text-[10px] px-1.5 rounded-full" :class="user.totalCount >= 40 ? 'bg-pink-100 text-pink-600 font-bold' : 'bg-gray-100 text-gray-500'">
                  {{ user.totalCount || 0 }}/81
                </span>
              </div>
            </div>
          </div>
          <span class="text-[10px] bg-gray-100 px-2 py-1 rounded text-gray-500 group-hover:bg-blue-200 group-hover:text-blue-700 transition">ë¹„êµ ></span>
        </div>

        <div v-if="filteredUserList.length === 0" class="text-center text-gray-400 py-8 text-xs bg-gray-50 rounded-xl">
          {{ searchKeyword ? 'ê²€ìƒ‰ëœ ë©¤ë²„ê°€ ì—†ì–´ìš”.' : 'í™œë™ ì¤‘ì¸ ë©¤ë²„ê°€ ì—†ì–´ìš”.' }}
        </div>
      </div>
    </div>
  </div>

  <!-- ë¹„êµ íŒì—… -->
  <div v-if="showComparePopup" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4" @click.self="showComparePopup = false">
    <div class="bg-white rounded-2xl w-full max-w-sm p-5 relative max-h-[85vh] overflow-y-auto shadow-2xl">
      <button @click="showComparePopup = false" class="absolute top-3 right-3 text-gray-300 hover:text-gray-500"><i class="fas fa-times"></i></button>

      <div class="text-center mb-5 mt-2">
        <div class="text-xs text-gray-400 mb-1">ë‚˜ vs ìƒëŒ€ë°©</div>
        <h3 class="text-lg font-bold text-gray-800 flex justify-center items-center">
          S{{ compareTarget?.server }} {{ compareTarget?.nickname }}
        </h3>
      </div>

      <div v-if="isLoading" class="flex justify-center py-8"><div class="loader"></div></div>

      <div v-else class="space-y-3">
        <div v-if="compareResult.mutual.give.length > 0 || compareResult.mutual.receive.length > 0" class="bg-red-50 p-3 rounded-xl border border-red-100">
          <h4 class="font-bold text-red-500 text-xs mb-2 flex items-center"><i class="fas fa-heart mr-1"></i> ìœˆìœˆ (ì„œë¡œ í•„ìš”í•´!)</h4>
          <div class="space-y-1.5">
            <div v-for="(card, idx) in compareResult.mutual.give" :key="'m_g_'+idx" class="flex justify-between items-center bg-white p-2 rounded-lg text-xs shadow-sm border border-red-50">
              <span class="truncate max-w-[55%] text-gray-600">ë‚´ê°€ <span class="font-bold text-blue-500">ì¤Œ</span>: {{ card.name }}</span>
              <div class="flex gap-1">
                <button @click="copyTradeText(card, 'give')" class="text-[10px] bg-gray-100 text-gray-600 px-2 py-1 rounded hover:bg-gray-200"><i class="far fa-copy"></i> ë³µì‚¬</button>
                <button @click="executeTrade(card, 'give')" class="text-[10px] bg-blue-500 text-white px-2 py-1 rounded shadow-sm" :class="{'btn-press': tradeCount < 3, 'btn-disabled': tradeCount >= 3}" :disabled="tradeCount >= 3">ë³´ë‚´ê¸°</button>
              </div>
            </div>

            <div v-for="(card, idx) in compareResult.mutual.receive" :key="'m_r_'+idx" class="flex justify-between items-center bg-white p-2 rounded-lg text-xs shadow-sm border border-red-50">
              <span class="truncate max-w-[55%] text-gray-600">ë‚´ê°€ <span class="font-bold text-red-500">ë°›ìŒ</span>: {{ card.name }}</span>
              <div class="flex gap-1">
                <button @click="copyTradeText(card, 'receive')" class="text-[10px] bg-gray-100 text-gray-600 px-2 py-1 rounded hover:bg-gray-200"><i class="far fa-copy"></i> ë³µì‚¬</button>
                <button @click="executeTrade(card, 'receive')" class="text-[10px] bg-red-500 text-white px-2 py-1 rounded shadow-sm" :class="{'btn-press': tradeCount < 3, 'btn-disabled': tradeCount >= 3}" :disabled="tradeCount >= 3">ë°›ê¸°</button>
              </div>
            </div>
          </div>
        </div>

        <div v-if="compareResult.giveOnly.length > 0" class="bg-blue-50 p-3 rounded-xl border border-blue-100">
          <h4 class="font-bold text-blue-500 text-xs mb-2 flex items-center"><i class="fas fa-gift mr-1"></i> ê¸°ë¶€ ê°€ëŠ¥ (ë‚˜ëŠ” ë‚¨ì•„ìš”)</h4>
          <div class="space-y-1.5">
            <div v-for="(card, idx) in compareResult.giveOnly" :key="'g_'+idx" class="flex justify-between items-center bg-white p-2 rounded-lg text-xs shadow-sm border border-blue-50">
              <span class="text-gray-600 truncate max-w-[55%]">{{ card.name }}</span>
              <div class="flex gap-1">
                <button @click="copyTradeText(card, 'give')" class="text-[10px] bg-gray-100 text-gray-600 px-2 py-1 rounded hover:bg-gray-200"><i class="far fa-copy"></i> ë³µì‚¬</button>
                <button @click="executeTrade(card, 'give')" class="text-[10px] bg-blue-500 text-white px-2 py-1 rounded shadow-sm" :class="{'btn-press': tradeCount < 3, 'btn-disabled': tradeCount >= 3}" :disabled="tradeCount >= 3">ë³´ë‚´ê¸°</button>
              </div>
            </div>
          </div>
        </div>

        <div v-if="compareResult.receiveOnly.length > 0" class="bg-gray-100 p-3 rounded-xl border border-gray-200">
          <h4 class="font-bold text-gray-500 text-xs mb-2 flex items-center"><i class="fas fa-hand-holding mr-1"></i> êµ¬í•´ìš” (ìƒëŒ€ëŠ” ë‚¨ì•„ìš”)</h4>
          <div class="space-y-1.5">
            <div v-for="(card, idx) in compareResult.receiveOnly" :key="'r_'+idx" class="flex justify-between items-center bg-white p-2 rounded-lg text-xs shadow-sm border border-gray-100">
              <span class="text-gray-600 truncate max-w-[55%]">{{ card.name }}</span>
              <div class="flex gap-1">
                <button @click="copyTradeText(card, 'receive')" class="text-[10px] bg-gray-100 text-gray-600 px-2 py-1 rounded hover:bg-gray-200"><i class="far fa-copy"></i> ë³µì‚¬</button>
                <button @click="executeTrade(card, 'receive')" class="text-[10px] bg-green-500 text-white px-2 py-1 rounded shadow-sm" :class="{'btn-press': tradeCount < 3, 'btn-disabled': tradeCount >= 3}" :disabled="tradeCount >= 3">ë°›ê¸°</button>
              </div>
            </div>
          </div>
        </div>

        <div v-if="compareResult.giveOnly.length === 0 && compareResult.receiveOnly.length === 0 && compareResult.mutual.give.length === 0 && compareResult.mutual.receive.length === 0"
             class="text-center text-gray-400 text-xs py-8 bg-gray-50 rounded-xl">
          êµí™˜í•  ìˆ˜ ìˆëŠ” ì¹´ë“œê°€ ì—†ì–´ìš” ğŸ˜…
        </div>
      </div>
    </div>
  </div>

  <!-- êµ¬í•´ìš”(êµí™˜ë„ìš°ë¯¸) íŒì—… -->
  <div v-if="showPopup" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4" @click.self="showPopup = false">
    <div class="bg-white rounded-2xl w-full max-w-sm p-6 relative shadow-2xl">
      <button @click="showPopup = false" class="absolute top-4 right-4 text-gray-300 hover:text-gray-500"><i class="fas fa-times"></i></button>
      <h3 class="text-lg font-bold mb-1 text-gray-800">ğŸ¤ êµí™˜ ë„ìš°ë¯¸</h3>
      <p class="text-xs text-gray-500 mb-6 border-b pb-2">
        <span class="text-pink-600 font-bold">{{ appConfig.albumNames[currentAlbumIdx] }} - ì‚¬ì§„{{ targetCardIdx + 1 }}</span> ë³´ìœ ì ì°¾ê¸°
      </p>

      <div v-if="isLoading" class="flex justify-center py-8"><div class="loader"></div></div>
      <div v-else-if="exchangeList.length === 0" class="text-center py-8 text-gray-400 bg-gray-50 rounded-xl">
        <div class="text-2xl mb-2">ğŸ˜­</div>ì—¬ìœ ë¶„ ìˆëŠ” ì¹œêµ¬ê°€ ì—†ì–´ìš”
      </div>

      <div v-else class="space-y-3 max-h-[50vh] overflow-y-auto pr-1">
        <div v-for="user in exchangeList" :key="user.id" class="border border-gray-100 p-3 rounded-xl bg-white shadow-sm flex flex-col gap-2">
          <div class="flex justify-between items-center">
            <div class="font-bold text-gray-700 text-sm">
              <span class="bg-blue-100 text-blue-600 text-[10px] px-1.5 py-0.5 rounded font-bold mr-1">S{{ user.server }}</span>{{ user.nickname }}
            </div>
            <button @click="openCompare(user)" class="text-[10px] bg-gray-800 text-white px-2 py-1 rounded shadow-sm">ì „ì²´ ë¹„êµ</button>
          </div>

          <div v-if="user.giveable.length > 0" class="bg-blue-50 p-2 rounded-lg">
            <div class="text-[10px] text-blue-500 font-bold mb-1 flex items-center"><i class="fas fa-gift mr-1"></i> ë‚´ê°€ ì¤„ ìˆ˜ ìˆëŠ” ê²ƒ:</div>
            <div class="flex flex-wrap gap-1">
              <span v-for="(card, cIdx) in user.giveable" :key="cIdx" class="text-[9px] bg-white border border-blue-100 px-1.5 py-0.5 rounded text-gray-500">{{ card }}</span>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- ë„ì›€ë§ -->
  <div v-if="showHelpPopup" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4" @click.self="showHelpPopup = false">
    <div class="bg-white rounded-2xl w-full max-w-sm p-6 relative shadow-2xl">
      <button @click="showHelpPopup = false" class="absolute top-4 right-4 text-gray-300 hover:text-gray-500"><i class="fas fa-times text-xl"></i></button>
      <h3 class="text-lg font-bold text-gray-800 mb-6 text-center">ğŸ’¡ ì‚¬ìš© ê°€ì´ë“œ</h3>
      <div class="bg-red-50 border border-red-200 rounded-lg p-3 mb-4 text-center">
        <span class="text-red-600 font-bold text-xs block mb-1">âš ï¸ ì£¼ì˜ì‚¬í•­ (í•„ë…)</span>
        <p class="text-xs text-red-500 leading-tight">
          ì´ ì•±ì€ <b>ì¥ë¶€</b>ì¼ ë¿ì…ë‹ˆë‹¤!<br>
          ê±°ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ë„ ê²Œì„ ì•„ì´í…œì€ ì´ë™í•˜ì§€ ì•Šì•„ìš”.<br>
          <b>ë°˜ë“œì‹œ ê²Œì„ì—ì„œ ë¨¼ì € êµí™˜í•˜ê³ </b> ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
        </p>
      </div>
      <div class="space-y-4 text-sm text-gray-600">
        <div class="flex items-start">
          <div class="bg-blue-100 text-blue-600 w-6 h-6 rounded-full flex items-center justify-center font-bold mr-3 flex-shrink-0">1</div>
          <div><span class="font-bold text-gray-800 block mb-0.5">ì¹´ë“œ ì…ë ¥</span>ì•¨ë²”ì—ì„œ <code>+</code> <code>-</code> ë¡œ ìˆ˜ëŸ‰ ì…ë ¥ (ìë™ ì €ì¥)</div>
        </div>
        <div class="flex items-start">
          <div class="bg-green-100 text-green-600 w-6 h-6 rounded-full flex items-center justify-center font-bold mr-3 flex-shrink-0">2</div>
          <div><span class="font-bold text-gray-800 block mb-0.5">1:1 ë§êµí™˜</span>ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ì—ì„œ <code>ë¹„êµ ></code> ëˆ„ë¥´ë©´ êµí™˜ ì¹´ë“œê°€ ë‚˜ì˜µë‹ˆë‹¤.</div>
        </div>
        <div class="flex items-start">
          <div class="bg-gray-100 text-gray-600 w-6 h-6 rounded-full flex items-center justify-center font-bold mr-3 flex-shrink-0">3</div>
          <div><span class="font-bold text-gray-800 block mb-0.5">ë³µì‚¬ & ë¶™ì—¬ë„£ê¸°</span><code>ë³µì‚¬</code> ë²„íŠ¼ì„ ëˆŒëŸ¬ ê²Œì„ ì±„íŒ…ì°½ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”!</div>
        </div>
      </div>
      <div class="mt-6 pt-4 border-t border-gray-100 text-center">
        <p class="text-xs text-gray-400">ğŸš« ì˜¤ë¥˜ ì œë³´ ë° ë¬¸ì˜: <span class="font-bold text-pink-500">67ì„­ ì‹œì†Œ</span></p>
      </div>
      <button @click="showHelpPopup = false" class="w-full bg-gray-800 text-white py-3 rounded-xl mt-4 font-bold text-sm hover:bg-gray-700">í™•ì¸í–ˆìŠµë‹ˆë‹¤</button>
    </div>
  </div>

  <!-- ê´€ë¦¬ì ì„¤ì •(ì•¨ë²”ëª…/ì»¤ë²„) -->
  <div v-if="showAdminSettingsPopup" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4" @click.self="showAdminSettingsPopup=false">
    <div class="bg-white rounded-2xl w-full max-w-sm p-5 relative max-h-[85vh] overflow-y-auto shadow-2xl">
      <button @click="showAdminSettingsPopup=false" class="absolute top-4 right-4 text-gray-300 hover:text-gray-500"><i class="fas fa-times"></i></button>
      <h3 class="text-base font-bold mb-4 text-gray-800">âš™ï¸ ì•¨ë²” ì„¤ì •</h3>
      <p class="text-[11px] text-gray-500 mb-4 leading-relaxed">
        ì•¨ë²” ì´ë¦„ê³¼ ì»¤ë²„ ì´ë¯¸ì§€ URLì„ ì €ì¥í•©ë‹ˆë‹¤.<br>
        ì €ì¥ ìœ„ì¹˜: <b>config/service_info</b>
      </p>

      <div class="space-y-4">
        <div v-for="(name, idx) in appConfig.albumNames" :key="idx" class="border border-gray-100 rounded-xl p-3 bg-gray-50">
          <div class="text-xs font-bold text-gray-700 mb-2">ì•¨ë²” {{ idx+1 }}</div>
          <input v-model="appConfig.albumNames[idx]" type="text" class="w-full p-2 border rounded text-sm mb-2" placeholder="ì•¨ë²” ì´ë¦„"/>
          <input v-model="appConfig.albumCovers[idx]" type="text" class="w-full p-2 border rounded text-sm text-gray-600" placeholder="ì»¤ë²„ ì´ë¯¸ì§€ URL"/>
          <div v-if="appConfig.albumCovers[idx]" class="mt-2">
            <img :src="appConfig.albumCovers[idx]" class="w-full h-28 object-cover rounded-lg border" @error="onCoverError(idx)"/>
            <div v-if="coverError[idx]" class="text-[10px] text-red-500 mt-1">ì´ë¯¸ì§€ URLì´ ì˜ëª»ëê±°ë‚˜ ì ‘ê·¼ì´ ë§‰í˜€ìˆì–´ìš”.</div>
          </div>
        </div>
      </div>

      <div class="mt-4 flex gap-2">
        <button @click="saveAppConfig" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl text-sm">ì €ì¥</button>
        <button @click="reloadConfigOnly" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-3 px-4 rounded-xl text-sm">ë˜ëŒë¦¬ê¸°</button>
      </div>
    </div>
  </div>

</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCFV593GWa2VoOf4IqMhVmbW2BGQqkDsE4",
    authDomain: "office-queen-album.firebaseapp.com",
    projectId: "office-queen-album",
    storageBucket: "office-queen-album.firebasestorage.app",
    messagingSenderId: "936201723618",
    appId: "1:936201723618:web:e4ec53040d668f023988bb",
    measurementId: "G-CEENHZG8HZ"
  };
  const ADMIN_PASSWORD = "1299";

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const { createApp, ref, computed } = Vue;

  createApp({
    setup() {
      const isLoggedIn = ref(false);
      const isLoading = ref(false);
      const currentView = ref('dashboard');
      const loginForm = ref({ server: '', nickname: '', password: '' });
      const userData = ref(null);
      const currentAlbumIdx = ref(0);
      const tradeCount = ref(0);

      // ê´€ë¦¬ì
      const adminTab = ref('transfer');
      const adminUserList = ref([]);
      const adminTargetUserId = ref('');
      const adminMatchList = ref([]);
      const adminUserSearch = ref('');
      const adminOnlyZero = ref(false);

      // íŒì—…
      const showPopup = ref(false);
      const showUserListPopup = ref(false);
      const showComparePopup = ref(false);
      const showHelpPopup = ref(false);
      const showAdminSettingsPopup = ref(false);

      // êµí™˜/ë¹„êµ
      const targetCardIdx = ref(0);
      const exchangeList = ref([]);
      const userList = ref([]);
      const compareTarget = ref(null);
      const compareResult = ref({ mutual: { give: [], receive: [] }, giveOnly: [], receiveOnly: [] });
      const searchKeyword = ref('');

      // ì„¤ì •(ì•¨ë²”ëª…/ì»¤ë²„)
      const appConfig = ref({
        albumNames: Array(9).fill().map((_, i) => `ì•¨ë²” ${i + 1}`),
        albumCovers: Array(9).fill("")
      });
      const coverError = ref(Array(9).fill(false));

      const safeStr = (v, fallback = '') => (typeof v === 'string' ? v : (v == null ? fallback : String(v)));
      const safeLower = (v) => safeStr(v).toLowerCase();

      const tsToMillis = (ts) => {
        if (!ts) return 0;
        try {
          if (typeof ts.toMillis === 'function') return ts.toMillis();
          if (typeof ts.toDate === 'function') return ts.toDate().getTime();
          if (ts instanceof Date) return ts.getTime();
          if (typeof ts === 'number') return ts;
          return 0;
        } catch (e) { return 0; }
      };

      const normalizeCollection = (col) => {
        const base = Array(81).fill(0);
        if (!Array.isArray(col)) return base;
        if (Array.isArray(col[0])) return base;
        const out = base.slice();
        for (let i = 0; i < 81; i++) {
          const v = col[i];
          out[i] = (typeof v === 'number' && isFinite(v) && v >= 0) ? Math.floor(v) : 0;
        }
        return out;
      };

      const isAdmin = computed(() => userData.value && userData.value.role === 'admin');

      const getMyDocId = () => {
        if (!userData.value) return null;
        if (userData.value.role === 'admin') return 'MASTER_ADMIN';
        return `S${userData.value.server}_${userData.value.nickname}`;
      };

      const getGameDate = () => {
        const now = new Date();
        if (now.getHours() < 8) now.setDate(now.getDate() - 1);
        return now.toISOString().split('T')[0];
      };

      const getActiveText = (timestamp) => {
        const ms = tsToMillis(timestamp);
        if (!ms) return 'ë¯¸ì ‘ì†';
        const diff = Date.now() - ms;
        const min = 60 * 1000, hour = 60 * min, day = 24 * hour;
        if (diff < 10 * min) return 'ë°©ê¸ˆ ì „';
        if (diff < hour) return `${Math.floor(diff / min)}ë¶„ ì „`;
        if (diff < day) return `${Math.floor(diff / hour)}ì‹œê°„ ì „`;
        return `${Math.floor(diff / day)}ì¼ ì „`;
      };

      const getActiveColor = (timestamp) => {
        const ms = tsToMillis(timestamp);
        if (!ms) return 'bg-gray-300';
        const diff = Date.now() - ms;
        if (diff < 30 * 60 * 1000) return 'bg-green-500';
        if (diff < 24 * 60 * 60 * 1000) return 'bg-yellow-400';
        return 'bg-gray-300';
      };

      const updateLastActive = async () => {
        if (!userData.value || isAdmin.value) return;
        const docId = getMyDocId();
        try {
          await db.collection('users').doc(docId).update({
            lastActive: firebase.firestore.FieldValue.serverTimestamp()
          });
        } catch (e) {}
      };

      const checkAndResetDailyLimit = async () => {
        if (!userData.value || isAdmin.value) return;
        const todayGameDate = getGameDate();
        if (userData.value.dailyExchangeDate !== todayGameDate) {
          userData.value.dailyExchangeCount = 0;
          userData.value.dailyExchangeDate = todayGameDate;
          tradeCount.value = 0;
          const docId = getMyDocId();
          try {
            await db.collection('users').doc(docId).update({
              dailyExchangeCount: 0,
              dailyExchangeDate: todayGameDate
            });
          } catch (e) {}
        } else {
          tradeCount.value = userData.value.dailyExchangeCount || 0;
        }
      };

      const loadAppConfig = async () => {
        try {
          const doc = await db.collection('config').doc('service_info').get();
          if (doc.exists) {
            const data = doc.data() || {};
            if (Array.isArray(data.albumNames) && data.albumNames.length === 9) appConfig.value.albumNames = data.albumNames;
            if (Array.isArray(data.albumCovers) && data.albumCovers.length === 9) appConfig.value.albumCovers = data.albumCovers;
          }
        } catch (e) {}
      };

      const reloadConfigOnly = async () => {
        coverError.value = Array(9).fill(false);
        await loadAppConfig();
        alert("ì„¤ì •ì„ ë‹¤ì‹œ ë¶ˆëŸ¬ì™”ì–´ìš”.");
      };

      const saveAppConfig = async () => {
        if (!confirm("ì•¨ë²” ì„¤ì •ì„ ì €ì¥í• ê¹Œìš”?")) return;
        isLoading.value = true;
        try {
          const names = (appConfig.value.albumNames || []).slice(0, 9);
          const covers = (appConfig.value.albumCovers || []).slice(0, 9);
          while (names.length < 9) names.push(`ì•¨ë²” ${names.length + 1}`);
          while (covers.length < 9) covers.push("");

          await db.collection('config').doc('service_info').set({
            albumNames: names,
            albumCovers: covers
          }, { merge: true });

          alert("ì €ì¥ ì™„ë£Œ!");
          showAdminSettingsPopup.value = false;
        } catch (e) {
          alert("ì €ì¥ ì‹¤íŒ¨: " + (e.message || e));
        } finally {
          isLoading.value = false;
        }
      };

      const onCoverError = (idx) => {
        const arr = coverError.value.slice();
        arr[idx] = true;
        coverError.value = arr;
      };

      // ì¼ë°˜ìœ ì € ë©¤ë²„ ë¦¬ìŠ¤íŠ¸(1ì¥ ì´ìƒë§Œ)
      const filteredUserList = computed(() => {
        if (!userList.value.length) return [];
        let list = userList.value;
        if (searchKeyword.value) {
          const keyword = searchKeyword.value.toLowerCase();
          list = list.filter(u =>
            safeLower(u.nickname).includes(keyword) ||
            safeStr(u.server).includes(keyword)
          );
        }
        list.sort((a, b) => tsToMillis(b.lastActive) - tsToMillis(a.lastActive));
        return list;
      });

      const fetchUsersAndShowList = async () => {
        showUserListPopup.value = true;
        isLoading.value = true;
        searchKeyword.value = '';
        userList.value = [];

        try {
          if (!userData.value) { alert("ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”."); return; }

          const snapshot = await db.collection('users').get();
          const users = [];
          const myDocId = getMyDocId();

          snapshot.forEach(doc => {
            const u = doc.data() || {};
            if (u.role === 'admin') return;
            if (doc.id === myDocId) return;

            const nickname = safeStr(u.nickname, '');
            if (!nickname) return;

            const col = normalizeCollection(u.collection);
            const total = col.reduce((a, b) => a + (b > 0 ? 1 : 0), 0);
            if (total <= 0) return;

            users.push({
              id: doc.id,
              server: u.server,
              nickname,
              collection: col,
              totalCount: total,
              lastActive: u.lastActive || u.lastUpdated || null
            });
          });

          userList.value = users;
        } catch (e) {
          alert("ë¦¬ìŠ¤íŠ¸ ë¡œë“œ ì‹¤íŒ¨: " + (e.message || e));
        } finally {
          isLoading.value = false;
        }
      };

      // âœ…âœ…âœ… ì—¬ê¸°ì„œë¶€í„° "ë¹„êµ íŒì—…ì´ ì•ˆëœ¸" ì›ì¸ í•´ê²°: openCompare ë³µêµ¬
      const openCompare = (targetUser) => {
        if (!targetUser) return;

        showUserListPopup.value = false;
        showPopup.value = false;

        compareTarget.value = targetUser;

        const myCol = normalizeCollection(userData.value?.collection);
        const targetCol = normalizeCollection(targetUser.collection);

        const res = { mutual: { give: [], receive: [] }, giveOnly: [], receiveOnly: [] };

        for (let i = 0; i < 81; i++) {
          const aIdx = Math.floor(i / 9);
          const cIdx = (i % 9) + 1;
          const albumName = appConfig.value.albumNames[aIdx] || `ì•¨ë²”${aIdx + 1}`;
          const cardName = `${albumName} - ì‚¬ì§„${cIdx}`;
          const cardObj = { index: i, name: cardName };

          const iHaveSpare = myCol[i] > 1;
          const iNeed = myCol[i] === 0;

          const uHaveSpare = targetCol[i] > 1;
          const uNeed = targetCol[i] === 0;

          if (iHaveSpare && uNeed) res.giveOnly.push(cardObj);
          if (uHaveSpare && iNeed) res.receiveOnly.push(cardObj);
        }

        if (res.giveOnly.length > 0 && res.receiveOnly.length > 0) {
          res.mutual.give = [...res.giveOnly];
          res.mutual.receive = [...res.receiveOnly];
        }

        compareResult.value = res;
        showComparePopup.value = true;
      };

      const copyTradeText = (card, type) => {
        const myServer = userData.value.server;
        const myName = userData.value.nickname;
        const targetServer = compareTarget.value.server;
        const targetName = compareTarget.value.nickname;

        const text = (type === 'give')
          ? `[ì˜¤í”¼ìŠ¤í€¸] S${targetServer} ${targetName}ë‹˜! S${myServer} ${myName}ì…ë‹ˆë‹¤.\n[${card.name}] ë“œë¦´ê²Œìš”! êµí™˜í•˜ì‹¤ë˜ìš”?`
          : `[ì˜¤í”¼ìŠ¤í€¸] S${targetServer} ${targetName}ë‹˜! S${myServer} ${myName}ì…ë‹ˆë‹¤.\ní˜¹ì‹œ [${card.name}] êµí™˜í•´ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”?`;

        navigator.clipboard.writeText(text).then(() => {
          alert("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹\nê²Œì„ ì±„íŒ…ì°½ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.");
        });
      };

      const executeTrade = async (card, type) => {
        await checkAndResetDailyLimit();
        if (tradeCount.value >= 3) {
          alert("ì˜¤ëŠ˜ êµí™˜ íšŸìˆ˜ 3íšŒë¥¼ ëª¨ë‘ ì†Œì§„í–ˆìŠµë‹ˆë‹¤.\në‚´ì¼ ì˜¤ì „ 8ì‹œì— ë‹¤ì‹œ ê°€ëŠ¥í•´ìš”! ğŸŒ™");
          return;
        }

        const actionName = type === 'give' ? `[${card.name}] ì„(ë¥¼) ì£¼ì‹œê² ìŠµë‹ˆê¹Œ?` : `[${card.name}] ì„(ë¥¼) ë°›ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?`;
        const effect = type === 'give' ? "ë‚´ ìˆ˜ëŸ‰ -1 / ìƒëŒ€ ìˆ˜ëŸ‰ +1" : "ë‚´ ìˆ˜ëŸ‰ +1 / ìƒëŒ€ ìˆ˜ëŸ‰ -1";
        if (!confirm(`${actionName}\n(${effect})\n\në‚˜ì™€ ìƒëŒ€ë°©ì˜ êµí™˜ íšŸìˆ˜ê°€ 1íšŒì”© ì°¨ê°ë©ë‹ˆë‹¤.`)) return;

        isLoading.value = true;
        try {
          const myDocRef = db.collection('users').doc(getMyDocId());
          const targetDocRef = db.collection('users').doc(compareTarget.value.id);
          const today = getGameDate();

          await db.runTransaction(async (transaction) => {
            const myDoc = await transaction.get(myDocRef);
            const targetDoc = await transaction.get(targetDocRef);
            if (!myDoc.exists || !targetDoc.exists) throw "ë¬¸ì„œ ì—†ìŒ";

            const myData = myDoc.data();
            const targetData = targetDoc.data();

            let myCurrentCount = myData.dailyExchangeCount || 0;
            if (myData.dailyExchangeDate !== today) myCurrentCount = 0;
            if (myCurrentCount >= 3) throw "ì˜¤ëŠ˜ ë‚˜ì˜ êµí™˜ í•œë„ê°€ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤!";

            let targetCount = targetData.dailyExchangeCount || 0;
            if (targetData.dailyExchangeDate !== today) targetCount = 0;
            if (targetCount >= 3) throw `ìƒëŒ€ë°©(${targetData.nickname}ë‹˜)ì˜ ì˜¤ëŠ˜ êµí™˜ íšŸìˆ˜ê°€ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤.`;

            const myCol = normalizeCollection(myData.collection);
            const targetCol = normalizeCollection(targetData.collection);

            const idx = card.index;
            if (type === 'give') {
              if (myCol[idx] < 1) throw "ì˜¤ë¥˜: ë‚´ ì¹´ë“œê°€ ë¶€ì¡±í•´ìš”!";
              myCol[idx]--; targetCol[idx]++;
            } else {
              if (targetCol[idx] < 1) throw "ì˜¤ë¥˜: ìƒëŒ€ë°© ì¹´ë“œê°€ ë¶€ì¡±í•´ìš”!";
              myCol[idx]++; targetCol[idx]--;
            }

            const myNewCount = myCurrentCount + 1;
            const targetNewCount = targetCount + 1;

            const now = firebase.firestore.FieldValue.serverTimestamp();
            transaction.update(myDocRef, {
              collection: myCol,
              dailyExchangeCount: myNewCount,
              dailyExchangeDate: today,
              lastUpdated: now,
              lastActive: now
            });
            transaction.update(targetDocRef, {
              collection: targetCol,
              dailyExchangeCount: targetNewCount,
              dailyExchangeDate: today,
              lastUpdated: now,
              lastActive: now
            });

            userData.value.collection = myCol;
            userData.value.dailyExchangeCount = myNewCount;
            userData.value.dailyExchangeDate = today;
            tradeCount.value = myNewCount;

            compareTarget.value.collection = targetCol;
          });

          localStorage.setItem('oq_user_v4', JSON.stringify(userData.value));
          updateLastActive();

          alert(`ê±°ë˜ ì™„ë£Œ! (ì˜¤ëŠ˜ ${tradeCount.value}/3íšŒ ì™„ë£Œ)`);
          openCompare(compareTarget.value); // ê²°ê³¼ ê°±ì‹ 
        } catch (e) {
          alert("ê±°ë˜ ì‹¤íŒ¨: " + (e.message || e));
        } finally {
          isLoading.value = false;
        }
      };

      // êµ¬í•´ìš”(êµí™˜ë„ìš°ë¯¸) - 0ì¸ ì¹´ë“œ ëˆŒë €ì„ ë•Œ ì—¬ìœ ë¶„(>1) ë³´ìœ ì ì°¾ê¸°
      const checkExchange = async (i) => {
        const col = normalizeCollection(userData.value.collection);
        const rIdx = (currentAlbumIdx.value * 9) + i;
        if (col[rIdx] > 0) return; // ì´ë¯¸ ìˆìœ¼ë©´ íŒì—… ì•ˆ ë„ì›€

        targetCardIdx.value = i;
        showPopup.value = true;
        exchangeList.value = [];
        isLoading.value = true;

        try {
          const snap = await db.collection('users').get();
          const matches = [];

          snap.forEach(doc => {
            const u = doc.data() || {};
            if (u.role === 'admin') return;
            if (doc.id === getMyDocId()) return;

            const theirCol = normalizeCollection(u.collection);

            // âœ… ì—¬ìœ ë¶„(2ì¥ ì´ìƒ) ìˆëŠ” ì‚¬ëŒë§Œ
            if (theirCol[rIdx] > 1) {
              const giveable = [];
              for (let k = 0; k < 81; k++) {
                if (col[k] > 1 && theirCol[k] === 0) {
                  const aIdx = Math.floor(k / 9);
                  const albumName = appConfig.value.albumNames[aIdx] || `ì•¨ë²”${aIdx + 1}`;
                  giveable.push(`${albumName} - ì‚¬ì§„${(k % 9) + 1}`);
                }
              }
              matches.push({
                id: doc.id,
                server: u.server,
                nickname: u.nickname,
                collection: theirCol,
                giveable
              });
            }
          });

          exchangeList.value = matches;
        } catch (e) {
          alert("ê²€ìƒ‰ ì‹¤íŒ¨: " + (e.message || e));
        } finally {
          isLoading.value = false;
        }
      };

      // ì•¨ë²”/ì¹´ìš´íŠ¸
      const currentAlbumCards = computed(() => {
        const col = userData.value ? normalizeCollection(userData.value.collection) : Array(81).fill(0);
        const start = currentAlbumIdx.value * 9;
        return col.slice(start, start + 9);
      });

      const updateCount = (i, chg) => {
        if (!userData.value) return;

        const col = normalizeCollection(userData.value.collection);
        const rIdx = (currentAlbumIdx.value * 9) + i;
        if (col[rIdx] + chg < 0) return;

        col[rIdx] += chg;
        userData.value.collection = col;

        localStorage.setItem('oq_user_v4', JSON.stringify(userData.value));
        const docId = getMyDocId();

        db.collection('users').doc(docId).update({
          collection: col,
          lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
          lastActive: firebase.firestore.FieldValue.serverTimestamp()
        }).catch(() => {});

        updateLastActive();
      };

      const getAlbumCount = (idx) => {
        if (!userData.value) return 0;
        const col = normalizeCollection(userData.value.collection);
        return col.slice(idx * 9, idx * 9 + 9).filter(c => c > 0).length;
      };

      const totalCount = computed(() => {
        if (!userData.value) return 0;
        const col = normalizeCollection(userData.value.collection);
        return col.filter(c => c > 0).length;
      });

      const totalProgress = computed(() => Math.round((totalCount.value / 81) * 100));
      const openAlbum = (idx) => { currentAlbumIdx.value = idx; currentView.value = 'detail'; };
      const prevAlbum = () => { if (currentAlbumIdx.value > 0) currentAlbumIdx.value--; };
      const nextAlbum = () => { if (currentAlbumIdx.value < 8) currentAlbumIdx.value++; };

      // ë¡œê·¸ì¸/ìë™ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ
      const handleLogin = async () => {
        if (isLoading.value) return;

        const server = loginForm.value.server;
        const nickname = safeStr(loginForm.value.nickname).trim();
        const password = safeStr(loginForm.value.password).trim();

        if (!nickname || !password) { alert('ì •ë³´ ì…ë ¥!'); return; }

        if (nickname === 'ê´€ë¦¬ì') {
          if (password !== ADMIN_PASSWORD) { alert("ë¹„ë²ˆ í‹€ë¦¼"); return; }
          await processLogin('MASTER_ADMIN', { nickname: 'ê´€ë¦¬ì', server: 0, password: ADMIN_PASSWORD, role: 'admin' });
          return;
        }

        if (!server) { alert('ì„œë²„ ì…ë ¥!'); return; }
        await processLogin(`S${server}_${nickname}`, { nickname, server, password, role: 'user' });
      };

      const processLogin = async (docId, userInfo) => {
        isLoading.value = true;
        await loadAppConfig();

        const docRef = db.collection('users').doc(docId);
        try {
          const doc = await docRef.get();
          let finalData;

          if (doc.exists) {
            const data = doc.data() || {};
            if (data.password !== userInfo.password) {
              alert('ë¹„ë²ˆ í‹€ë¦¼');
              return;
            }
            data.collection = normalizeCollection(data.collection);
            finalData = data;
          } else {
            finalData = {
              ...userInfo,
              collection: Array(81).fill(0),
              createdAt: firebase.firestore.FieldValue.serverTimestamp(),
              lastActive: firebase.firestore.FieldValue.serverTimestamp(),
              lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
              dailyExchangeCount: 0,
              dailyExchangeDate: getGameDate()
            };
            await docRef.set(finalData);
          }

          userData.value = finalData;
          localStorage.setItem('oq_user_v4', JSON.stringify(finalData));
          isLoggedIn.value = true;

          if (finalData.role !== 'admin') {
            await checkAndResetDailyLimit();
            await updateLastActive();
          } else {
            await fetchAdminData();
          }
        } catch (e) {
          alert('ì˜¤ë¥˜: ' + (e.message || e));
        } finally {
          isLoading.value = false;
        }
      };

      const checkLogin = async () => {
        const savedUser = localStorage.getItem('oq_user_v4');
        if (!savedUser) return;
        try {
          const parsed = JSON.parse(savedUser);
          userData.value = parsed;
          await loadAppConfig();
          isLoggedIn.value = true;

          if (userData.value.role !== 'admin') {
            userData.value.collection = normalizeCollection(userData.value.collection);
            await checkAndResetDailyLimit();
            await updateLastActive();
          } else {
            await fetchAdminData();
          }
        } catch (e) {}
      };

      const logout = () => {
        localStorage.removeItem('oq_user_v4');
        userData.value = null;
        isLoggedIn.value = false;
        loginForm.value = { server: '', nickname: '', password: '' };

        showAdminSettingsPopup.value = false;
        showUserListPopup.value = false;
        showComparePopup.value = false;
        showPopup.value = false;

        adminTab.value = 'transfer';
        adminUserSearch.value = '';
        adminOnlyZero.value = false;
      };

      checkLogin();

      // ---------------- ê´€ë¦¬ì ê¸°ëŠ¥ ----------------

      const fetchAdminData = async () => {
        if (!isAdmin.value) return;

        isLoading.value = true;
        adminUserList.value = [];
        adminMatchList.value = [];
        adminTargetUserId.value = '';

        try {
          const snapshot = await db.collection('users').get();
          const users = [];

          snapshot.forEach(doc => {
            const u = doc.data() || {};
            if (doc.id === 'MASTER_ADMIN') return;
            if (u.role === 'admin') return;

            const nickname = safeStr(u.nickname, '');
            if (!nickname) return;

            const col = normalizeCollection(u.collection);
            const total = col.reduce((a, b) => a + (b > 0 ? 1 : 0), 0);

            users.push({
              id: doc.id,
              server: u.server,
              nickname,
              collection: col,
              totalCount: total,
              lastActive: u.lastActive || u.lastUpdated || null
            });
          });

          users.sort((a, b) => safeStr(a.nickname).localeCompare(safeStr(b.nickname), 'ko'));
          adminUserList.value = users;
        } catch (e) {
          alert("ê´€ë¦¬ì ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: " + (e.message || e));
        } finally {
          isLoading.value = false;
        }
      };

      const adminUserListSorted = computed(() => {
        const list = adminUserList.value.slice();
        list.sort((a, b) => safeStr(a.nickname).localeCompare(safeStr(b.nickname), 'ko'));
        return list;
      });

      const toggleAdminOnlyZero = () => { adminOnlyZero.value = !adminOnlyZero.value; };

      const adminUsersForManage = computed(() => {
        let list = adminUserList.value.slice();
        if (adminUserSearch.value) {
          const k = adminUserSearch.value.toLowerCase();
          list = list.filter(u =>
            safeLower(u.nickname).includes(k) ||
            safeStr(u.server).includes(k) ||
            safeLower(u.id).includes(k)
          );
        }
        if (adminOnlyZero.value) list = list.filter(u => (u.totalCount || 0) === 0);
        list.sort((a, b) => tsToMillis(b.lastActive) - tsToMillis(a.lastActive));
        return list;
      });

      const deleteUser = async (u) => {
        if (!isAdmin.value) return;
        if (!u || !u.id) return;

        const ok = confirm(`ì •ë§ ì‚­ì œí• ê¹Œìš”?\n\nS${u.server} ${u.nickname}\n(docId: ${u.id})\n\nâ€» ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
        if (!ok) return;

        isLoading.value = true;
        try {
          await db.collection('users').doc(u.id).delete();
          alert("ì‚­ì œ ì™„ë£Œ");
          await fetchAdminData();
        } catch (e) {
          alert("ì‚­ì œ ì‹¤íŒ¨: " + (e.message || e));
        } finally {
          isLoading.value = false;
        }
      };

      const deleteAllZeroUsers = async () => {
        if (!isAdmin.value) return;

        const zeros = adminUserList.value.filter(u => (u.totalCount || 0) === 0);
        if (zeros.length === 0) { alert("0ì¥ ìœ ì €ê°€ ì—†ìŠµë‹ˆë‹¤."); return; }

        const ok = confirm(`0ì¥ ìœ ì € ${zeros.length}ëª…ì„ ì¼ê´„ ì‚­ì œí• ê¹Œìš”?\n\nâ€» ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
        if (!ok) return;

        isLoading.value = true;
        try {
          const chunkSize = 400;
          for (let i = 0; i < zeros.length; i += chunkSize) {
            const chunk = zeros.slice(i, i + chunkSize);
            const batch = db.batch();
            chunk.forEach(u => batch.delete(db.collection('users').doc(u.id)));
            await batch.commit();
          }
          alert("0ì¥ ìœ ì € ì¼ê´„ ì‚­ì œ ì™„ë£Œ");
          await fetchAdminData();
        } catch (e) {
          alert("ì¼ê´„ ì‚­ì œ ì‹¤íŒ¨: " + (e.message || e));
        } finally {
          isLoading.value = false;
        }
      };

      const resetEventAllUsers = async () => {
        if (!isAdmin.value) return;

        const ok = confirm(
          "âš ï¸ ì´ë²¤íŠ¸ ì´ˆê¸°í™”ëŠ” ëª¨ë“  ìœ ì €ì˜ ì¹´ë“œ ì •ë³´ë¥¼ 0ìœ¼ë¡œ ë¦¬ì…‹í•©ë‹ˆë‹¤.\n" +
          "ê³„ì •ì€ ì‚­ì œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\n" +
          "ì§„ì§œ ì§„í–‰í• ê¹Œìš”?"
        );
        if (!ok) return;

        const ok2 = prompt("ì •ë§ ì´ˆê¸°í™”í•  ê±°ë©´ RESET ì„ ì…ë ¥í•´ì¤˜");
        if (ok2 !== "RESET") { alert("ì·¨ì†Œë¨"); return; }

        isLoading.value = true;
        try {
          const snapshot = await db.collection('users').get();
          const ids = [];
          snapshot.forEach(doc => {
            const data = doc.data() || {};
            if (doc.id === 'MASTER_ADMIN') return;
            if (data.role === 'admin') return;
            ids.push(doc.id);
          });

          if (ids.length === 0) { alert("ì´ˆê¸°í™”í•  ìœ ì €ê°€ ì—†ìŠµë‹ˆë‹¤."); return; }

          const today = getGameDate();
          const chunkSize = 400;

          for (let i = 0; i < ids.length; i += chunkSize) {
            const chunk = ids.slice(i, i + chunkSize);
            const batch = db.batch();
            const now = firebase.firestore.FieldValue.serverTimestamp();

            chunk.forEach(id => {
              batch.update(db.collection('users').doc(id), {
                collection: Array(81).fill(0),
                dailyExchangeCount: 0,
                dailyExchangeDate: today,
                lastUpdated: now,
                lastActive: now
              });
            });

            await batch.commit();
          }

          alert(`ì´ë²¤íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ! (ëŒ€ìƒ ${ids.length}ëª…)`);
          await fetchAdminData();
        } catch (e) {
          alert("ì´ë²¤íŠ¸ ì´ˆê¸°í™” ì‹¤íŒ¨: " + (e.message || e));
        } finally {
          isLoading.value = false;
        }
      };

      const calculateAdminMatches = () => {
        if (!adminTargetUserId.value) return;

        const targetUser = adminUserList.value.find(u => u.id === adminTargetUserId.value);
        if (!targetUser) return;

        const targetCol = normalizeCollection(targetUser.collection);
        const matches = [];

        adminUserList.value.forEach(donor => {
          if (donor.id === targetUser.id) return;

          const donorCol = normalizeCollection(donor.collection);
          const giveable = [];

          for (let i = 0; i < 81; i++) {
            if ((donorCol[i] || 0) > 1 && (targetCol[i] || 0) === 0) {
              const aIdx = Math.floor(i / 9);
              const albumName = appConfig.value.albumNames[aIdx] || `ì•¨ë²”${aIdx + 1}`;
              giveable.push({ index: i, name: `${albumName} - ì‚¬ì§„${(i % 9) + 1}` });
            }
          }

          if (giveable.length > 0) matches.push({ user: donor, giveable });
        });

        adminMatchList.value = matches;
      };

      const executeAdminTransfer = async (match) => {
        if (!isAdmin.value) return;
        if (!adminTargetUserId.value) return;

        const ok = confirm(`S${match.user.server} ${match.user.nickname}ë‹˜ì˜ ì¹´ë“œ ${match.giveable.length}ì¥ì„ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?\n\n(ë„ë„ˆ ìˆ˜ëŸ‰ -1 / íƒ€ê²Ÿ ìˆ˜ëŸ‰ +1)`);
        if (!ok) return;

        isLoading.value = true;
        try {
          const targetUserRef = db.collection('users').doc(adminTargetUserId.value);
          const donorUserRef = db.collection('users').doc(match.user.id);

          await db.runTransaction(async (t) => {
            const targetDoc = await t.get(targetUserRef);
            const donorDoc = await t.get(donorUserRef);
            if (!targetDoc.exists || !donorDoc.exists) throw "ìœ ì € ì •ë³´ ì—†ìŒ";

            const targetCol = normalizeCollection(targetDoc.data().collection);
            const donorCol = normalizeCollection(donorDoc.data().collection);

            match.giveable.forEach(card => {
              const idx = card.index;
              if (donorCol[idx] > 1) { donorCol[idx]--; targetCol[idx]++; }
            });

            const now = firebase.firestore.FieldValue.serverTimestamp();
            t.update(targetUserRef, { collection: targetCol, lastUpdated: now, lastActive: now });
            t.update(donorUserRef, { collection: donorCol, lastUpdated: now, lastActive: now });
          });

          alert("ì´ë™ ì™„ë£Œ! âš¡");
          await fetchAdminData();
          adminTargetUserId.value = '';
          adminMatchList.value = [];
        } catch (e) {
          alert("ì˜¤ë¥˜ ë°œìƒ: " + (e.message || e));
        } finally {
          isLoading.value = false;
        }
      };

      return {
        // ìƒíƒœ
        isLoggedIn, isLoading, loginForm, userData, isAdmin,
        // ë·°/ì•¨ë²”
        currentView, currentAlbumIdx, currentAlbumCards, appConfig,
        openAlbum, prevAlbum, nextAlbum, updateCount, getAlbumCount, totalCount, totalProgress,
        // íŒì—…
        showPopup, showUserListPopup, showComparePopup, showHelpPopup, showAdminSettingsPopup,
        // ë©¤ë²„/ê²€ìƒ‰
        searchKeyword, filteredUserList, fetchUsersAndShowList,
        // ë¹„êµ/êµí™˜ ë¡œì§
        compareTarget, compareResult, openCompare, executeTrade, copyTradeText,
        // êµí™˜ë„ìš°ë¯¸
        targetCardIdx, exchangeList, checkExchange,
        // ìœ í‹¸
        getActiveText, getActiveColor, tradeCount,
        // ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ
        handleLogin, logout,
        // ê´€ë¦¬ì
        adminTab, adminUserListSorted, adminTargetUserId, adminMatchList,
        calculateAdminMatches, executeAdminTransfer,
        adminUserSearch, adminOnlyZero, adminUsersForManage, toggleAdminOnlyZero,
        deleteUser, deleteAllZeroUsers, resetEventAllUsers, fetchAdminData,
        // ì„¤ì •
        saveAppConfig, reloadConfigOnly, onCoverError, coverError
      };
    }
  }).mount('#app');
</script>

</body>
</html>
